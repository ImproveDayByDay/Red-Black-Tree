# Red-Black-Tree
# 红黑树简介

如果没有学习过二叉搜索树直接来学习红黑树，个人感觉会很懵，建议先了解一下什么是二叉搜索树再来读接下来的内容，红黑树是一颗平衡二叉树，自平衡二叉树有很多种，包括AVL树，伸展树，替罪羊树，至于这些树之间有什么区别，这里不再进行叙述，那为什么会出现平衡二叉树呐，那是由于二叉搜索树的查找效率不是很稳定，最坏情况查找时间复杂度会为O(n),下面我们来看一下二叉搜索树最坏情况，插入的节点依次为1，2，3，4，5，6，7，8，9。当查找9这个节点时就会一直向右查找，其实这个二叉查找树已经退化成一个链表了，所以查找起来十分慢，为了解决二叉查找树的这个问题，自平衡二叉树应运而生。

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605859898559-b7f0e485-9402-418d-9402-2b3d4ba55521.png)

# 红黑树的性质

红黑树满足如下性质：

- 每个节点要么是红色要么是黑色
- 根节点永远是黑色的
- 两个红色节点不能相邻，也就是说如果一个节点是红色，他的父节点以及子节点都不能是红色节点
- 任何一个节点到每个叶节点的路径包含的黑色节点的数量都相等

# 如何学习红黑树

学习大概一周的红黑树，对红黑树的一些细节还不是特别理解，我认为学习红黑树的最好方式应该是结合2-3-4树学习，先学习一下2-3-4树，然后再来学习红黑树，应该能很好理解，如果没有学习过2-3-4树，建议先看一下[我之前的笔记](https://www.yuque.com/justdoit-gexgz/wkhgdo/boingi)，好了，下面就让我们来探索一下神奇的红黑树吧。

# 红黑树的插入操作

红黑树的操作包含如下几步：

- 第一步，先找到要插入节点的位置，这一步和二叉排序的插入操作是一样的，就是依次和当前根节点进行比较，如果插入节点的值比当前节点的值小，则当前节点指向左子树，否则指向右子树，直到找到一个空节点，这个位置就是要插入节点的位置。下面来看图了解一下这一步的操作。下图是一个红黑树，

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605873016637-39aa375a-500d-439d-b145-0122425fe5d9.png)

现在我们要插入值为9的节点，我们该如何进行操作呢，首先和根节点进行比较，由于插入节点的值为9，而根节点的值为2，所以，根节点指向右子树，当前指向的节点为4，又由于插入节点的值大于当前节点的值，所以当前节点指向右子树，就这样一直循环，知道当前节点为空，我们找到了要插入节点的位置，也就是6节点的右节点。

- 第二步，给插入点着色，要插入的节点都是一个颜色，大家可以想一想，我在这里留一段空白，让大家想一下，大家先不要看下面，









当当当，答案公布啦，每个插入节点都是红色的，那为什么呐，我们可以看一下红黑树的性质最后一条：任何一个节点到每个叶节点的路径包含的黑色节点的数量都相等，当你插入节点为红色时就不会影响红黑树这条性质，但是会破坏红黑树第三条性质，有可能插入节点的父节点也是一个红色节点，所以我们需要调整一下树，使其成为红黑树。

- 第三步：调整树，使其成为红黑树。这里我们还要说一点，就是我们把红黑树的空节点都指向一个节点，并且空节点的颜色为黑色，这样方便了我们插入和删除操作。我们思考一下，当插入一个红色节点时，一红会出现哪几种情况呢，这里我们只讨论插入节点在其祖父的左子树上，在右子树上的操作和左子树上的操作基本上差不多，只是把左右指针相互切换一下，把左右旋转相互切换一下。以我的理解一共包含三种情况。

- - 当插入节点的父节点是一个黑色节点直接退出循环
  - 当插入节点的父节点是一个红色节点的时候，这时需要调整树，这个情况包含两种子情况，第一种是其叔叔节点为红色(叔叔节点是指祖父除了父亲节点的另有一个节点)，下面用图来说明一下

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605921377931-585384a0-0e2a-434f-bfc0-9ea04b2d7c48.png)

那有的人可能会问了啊，那为什么祖父节点不能为红呢，首先我们需要明确一点，此种情况是父亲节点为红色，而且我们还需要明确一下，在这个节点插入之前，这个树是一个红黑树，满足红黑树的所有性质，所以不能有两个相邻的红色节点，所以祖父的颜色不可能为红色，只能为黑色。我们先来看一下叔叔为红色的情况：

- - - 叔叔为红色：当叔叔为红色时，在这个节点插入之前，叔叔、父亲、祖父在2-3-4树里应该对应的是4节点，当再插入一个红色节点时，这个四节点应该分解，然后再让插入节点和父亲组成一个二节点，可能大家还不是特别理解我的意思，那我先讲一下2-3-4树对于这种情况如何插入：

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605922039558-3fcb001d-90aa-4362-9c92-dd2d1e30fc06.png)

红黑树的红色链接就对应与父亲节点组成一个多节点，76，85，90组成的四节点对应红黑树应该如     下图

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605923858257-b39c5c2c-77fb-491f-8a3e-e4ec218e812e.png)

那我们看看这种情况2-3-4树是怎么处理的呢，他首先把这个四节点转换成三个二节点，然后再让其·   中插入节点和一个子节点组成一个三节点，那转换成红黑树该怎么操作呢，只需把父亲节点和叔叔     节点调成黑色，并让其祖父节点调成红色即可，这里把父亲和叔叔调成黑色就意味着已经拆分成了     二节点，那有的同学会问了，为什么要把祖父调成红色呀，你们想一下，祖父是黑色，那岂不是违     反了红黑树的性质，我们把原来的父亲和叔叔节点都变成了黑色，相当都在祖父这个路径下都多了    一个黑色，所以我们要把祖父编程红色，相当加了一个黑色节点又减了一个黑色节点，平衡了。最     后我们需要让当前当前节点指向祖父节点继续循环，直到当前节点的父亲为黑节点。这里我们先不    介绍例子，一会我们学完另一种情况直接来一个整体的例子。下面我们来看另一种情况，

- - - 叔叔为黑色：当插入节点是父亲的右子树时，进行左旋

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605923977281-eddeb440-c197-4d82-b49d-d3ceeefd5c32.png)

旋转之后为：

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605924085166-698ab28c-f00d-416b-a936-e61e9ac36c84.png)

这种情况我们对我们对祖父进行右旋，并改变使祖父颜色为红色，父亲节点为黑色，转换结果为下图：

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605925175777-1ea21d37-d349-4402-bfde-78645be1551f.png)

我们的插入过程马上就要结束了，还有一个小小的细节，那就是我们到最后可能让根节点成为红色，所以我们在最后只需让根节点成为黑色即可了。

最后让我们看一个例子来再详细了解一下插入的过程。现在我们假设有这样一颗红黑树，

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605925924660-966abb81-e3fb-4ad8-a91c-dd904a5d31f3.png)

假设我们要插入的节点为8，我们先找到插入节点的位置，并给插入的节点涂上颜色，如下图：

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605926077721-97373117-cddc-4f87-8a83-f71a39b19e2f.png)

接下来我们要做的就是调整树的结构，使其成为红黑树，首先，我们看一下，叔叔节点的颜色为红色，     那非常好办呀，直接让叔叔和父亲为黑色，然后让祖父指向红色，让当前节点指向祖父继续循环，我们     来看一下经过这一步调整后的树。

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605926520754-39e59a1f-e8d2-45b1-a469-4ee43c2c7c71.png)

由于当前节点的父亲为红色，继续循环，咱们看一下现在属于哪种情况呢，叔叔的节点为黑色，那应该     怎么办呢，对祖父进行左旋，然后调整颜色，调整之后如下：

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605926934452-a26e815e-e32c-439e-94e0-9fe0833c31b7.png)

调整之后这就是一颗红黑树了，因为当前节点的父节点为黑色，退出循环。结束

# 红黑树的删除操作

删除真的是很复杂，真的很复杂，真的很复杂，重要的事说三遍哟，但其实拆分来看也不是特别复杂，只是情况多而已。那我们还是一步一步来，首先，我们需要定位到我们删除的那个节点，这其实就是一个查找的过程。我们先讨论删除节点左子树为空、右子树为空子树都为空的情况，两个子树都不为空的情况我们最后再讨论，因为两个子树不为空的情况需要用到前面这些情况。

- 定位到要删除的那个元素的节点

我们现在讨论删除的节点是其中一颗子树为空或者都为空，那我们现在讨论一下删除的节点有哪些情况

- 删除的节点为红色，当删除的节点为红色时，我们直接删除就可以了，然后让他的左子树或者右子树替换他的位置，我们现在看一下这个操作影不影响红黑树的性质，由于删除的是红色节点，所以不影响每个节点到叶节点黑色节点的数量，所以当删除节点的为红色时直接删除就可以了。
- 删除的节点为黑色，但是删除节点的子节点有红色节点，我们想一下，当直接删除一个黑色节点会影响红黑树哪条性质，当直接删除一个黑色节点，会影响红黑树的第四条性质，也就是一个节点到叶节点路径上的黑色节点数量相等，但是当删除一个黑色节点之后，明显不相等了啊，这个时候该怎么办呢，这个时候应该让删除节点的红色子节点替换删除节点，并把红色节点的颜色改成黑色，这样相当于减少了一个黑色节点又增加了一个黑色节点，所以相当于就平衡了。
- 删除节点的子节点都为黑色，我们首先让他的子树替换他，但是我们需要平衡这个节点所在的路径，因为这个节点所在的路径不满足红黑树的性质，我们这里讨论的是平衡节点是父亲的左节点，我们下面把这个平衡节点命名为N

- - 当这个平衡节点为根节点时，直接退出循环，因为当这个平衡节点是根节点时，说明根节点到叶节点的每一个路径都少了一个黑色节点，整体都少了一个，相当于没少。所以，当N为根节点时，直接删除。
  - 当平衡节点的父节点，兄弟节点以及兄弟节点的子节点都为黑色节点时，如下图所示：

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605938538001-50f9c0a6-7c04-4722-9b4f-5dd612d394fa.png)

遇到这种情况该怎么办呢，大家想一下，由于平衡节点那条路径上少了一个黑色节点，当让那条路径上     多了一个黑色即可平衡，这种情况，只需交换父节点和兄弟节点的颜色即可平衡结束。下面我们来看一     下交换玩之后的情况。

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605938838969-4fb0d1eb-fe21-4dd9-b5d7-419bac8bb311.png)

交换父节点和兄弟节点的颜色之后，我们发现，N节点的路径上多了一个黑色，平衡了，而且没有破坏其他路径的平衡。所以平衡完毕。退出循环。

- - 当平衡节点的兄弟节点为黑色时，他的兄弟节点的右节点为红节点，其他节点为蓝色节点，蓝色节点意思是可以红也可以黑。如下图：

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605939526562-b8b79e8b-2b07-40f9-88ab-59ec515db304.png)

这种情况，兄弟节相当于2-3-4树的三节点，这个时候删除可以从兄弟节点借一个key给父节点，然后让     父节点和删除节点组成一个三节点，这样直接删除就不会影响2-3-4树的性质了。那到红黑树该怎么操作     呢。

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605939786554-9e55c458-0d58-4848-a1bc-adcb37d242a3.png)

这种情况应该首先对N的父节点进行左旋，然后N的兄弟节点的颜色为N的父节点的颜色，让N的父节点     的颜色为黑色，最后让N的兄弟节点的右节点颜色为黑色，平衡结束，下面看一下平衡后的状态。

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605940123816-1fa52453-c3b9-44ab-a620-eb2b36ea87b5.png)

- - 下面看一下另一种情况，N节点的父亲，兄弟，以及兄弟的所有子节点都为黑色，如图所示：

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605940336993-d5df7a4f-02e7-4ff9-aa21-a0b42d9c9dd1.png)

对于这种情况应该怎么操作呢，由于平衡节点所在路径少了一个黑色节点，可以让另一个路径也少一个    黑色节点，这样父节点的两个路径就相当于都少了一个黑色节点，新的平衡节点为父节点，继续进行平    衡操作。如下图：

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605940770783-cf2415ac-c6b1-47bf-b479-9315ad45d139.png)

- - 当N节点的兄弟节点为黑，兄弟节点的左节点为红节点，右节点为黑节点，如下图：

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605942144007-8cc2558a-c564-48ce-be5d-3f71d25e5019.png)

这种情况该怎么进行处理呢，我看看这种情况和第三种情况是不是很类似，我们可以把这种情况转换为·     第三种情况，我们可以对兄弟节点进行右旋，然后改变兄弟节点和兄弟节点左节点的颜色，变换情况如     下：

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605942240106-92356957-a838-4ddc-8284-20878e72a2fa.png)

这样就把这种情况转换到情况3，继续进行平衡操作。

- - 最后一种情况啦，终于要结束了，最后一种情况比较简单，不用担心，这种情况是父节点为黑，兄弟节点为红，

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605942298718-fd6b7e9f-5635-436a-bc82-c17886037bad.png)

那怎么处理这种情况呢，只需左旋父节点就可以转换为情况2，然后进行继续平衡。

![image.png](https://cdn.nlark.com/yuque/0/2020/png/2871888/1605942388702-2b500d91-eac6-4b3f-bf4b-01d231d2ec08.png)

- 最后让我们探讨一下当删除节点的左子树不空并且右子树也不为空。首先找到删除节点右子树最下节点，让这个最小节点替换删除节点，然后在转换为删除最小节点，由于最小节点肯定满足之前的情况。

# 总结

第一次写了这么长笔记，肯定有很多不足，希望大家谅解。